<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Daily Inspiration â€” Multiâ€‘Category PWA</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f57c00">
<style>
  :root {
    --bg1:#ffecd2; --bg2:#fcb69f; --card:rgba(255,255,255,0.96);
    --accent:#f57c00; --muted:#6b6b6b; --glass:rgba(255,255,255,0.6); --radius:16px;
    font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;
  }
  *,*::before,*::after{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0;display:block;width:100%;max-width:100vw;overflow-x:hidden;background:linear-gradient(135deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased;color:#222;}

  .app{width:100%;max-width:720px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:18px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:56px;height:56px;border-radius:50%;background:linear-gradient(180deg,#fff,#fee9d6);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);box-shadow:0 8px 22px rgba(0,0,0,0.08);backdrop-filter:saturate(180%) blur(8px);}
  h1{font-size:1.15rem;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:0.95rem}

  .card{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:0 10px 32px rgba(0,0,0,0.08)}

  /* Categories: horizontally scrollable on mobile */
  .categories{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px; -webkit-overflow-scrolling:touch; scrollbar-width:none; scroll-snap-type:x mandatory}
  .categories::-webkit-scrollbar{display:none}
  .cat{color:#222;background:rgba(245,124,0,0.12);padding:8px 12px;border-radius:12px;cursor:pointer;border:1px solid rgba(245,124,0,0.12);font-weight:600;scroll-snap-align:start}
  .cat.active{background:#fff;border-color:rgba(0,0,0,0.08);box-shadow:0 8px 18px rgba(0,0,0,0.06)}

  .quote-area{display:flex;flex-direction:column;gap:12px}
  .quote-box{padding:26px;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,0.99),rgba(255,255,255,0.94));box-shadow:0 6px 22px rgba(0,0,0,0.06);max-height:60vh;overflow:auto}

  .quote-text{font-size:1.45rem;line-height:1.65;margin:0;transition:opacity .28s ease,transform .28s ease}
  .author{font-weight:700;color:var(--muted);text-align:right;margin-top:8px;transition:opacity .28s ease,transform .28s ease}

  /* entrance state for animation */
  .enter{opacity:0;transform:translateY(8px)}

  .controls,.favorites{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;align-items:center}
  button{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:700}
  .btn-ghost{background:transparent;color:var(--accent);border:2px solid rgba(255,255,255,0.5);}
  .small{padding:10px 12px;font-size:1rem;border-radius:12px}
  .meta{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .fav-list{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .chip{background:#fff;padding:8px 12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);font-size:0.95rem;cursor:pointer}
  .fav-active{filter:drop-shadow(0 2px 6px rgba(0,0,0,0.12));}

  /* Splash */
  #splash{position:fixed;width:100%;height:100%;background:linear-gradient(to right,#ffecd2,#fcb69f);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;opacity:1;transition:opacity 400ms ease,transform 400ms ease;}
  #splash img{width:120px;height:120px;margin-bottom:18px;border-radius:50% !important;overflow:hidden;box-shadow:0 8px 22px rgba(0,0,0,0.12);}
  #splash h1{font-size:2rem;color:#fff;text-shadow:1px 1px 6px rgba(0,0,0,0.2)}
  .hidden-splash{opacity:0;transform:scale(1.03);pointer-events:none}

  /* Floating next button for mobile */
  #btn-float-next,#btn-float-prev{position:fixed;bottom:calc(20px + env(safe-area-inset-bottom));padding:14px 18px;border-radius:50px;background:var(--accent);color:#fff;font-weight:800;border:none;box-shadow:0 8px 26px rgba(0,0,0,0.16);z-index:999}
  #btn-float-next{right:20px}
  #btn-float-prev{left:20px}

  /* smaller screens */
  @media (max-width:600px){
    .app{padding:16px}
    .logo{width:48px;height:48px}
    .quote-text{font-size:1.15rem;line-height:1.55}
    .author{font-size:1rem}
    .card{padding:18px}
    .quote-box{padding:18px;border-radius:14px}
    button.small{padding:12px 14px;font-size:0.98rem}
    /* show float on mobile */
    #btn-float-next,#btn-float-prev{display:block}
  }
  @media (min-width:601px){
    #btn-float-next,#btn-float-prev{display:none}
  }

  /* accessibility focus */
  .cat:focus, button:focus, .chip:focus{outline:3px solid rgba(245,124,0,0.18);outline-offset:3px}

  footer{margin-top:8px;color:var(--muted);font-size:0.9rem;text-align:center}
</style>
</head>
<body>

<div id="splash" role="status" aria-live="polite">
  <img src="icon-512.png" alt="App Icon">
  <h1>Daily Inspiration</h1>
</div>

<main class="app" role="main">
  <header>
    <div class="brand">
      <div class="logo">DI</div>
      <div>
        <h1>Daily Inspiration</h1>
        <p class="lead">Choose a category. Save favorites. Daily reminders.</p>
      </div>
    </div>
    <div class="header-controls">
      <button id="btn-share-image" class="small" title="Share image">Share Quote</button>
      <button id="btn-notify" class="small" aria-pressed="false">Enable Notification</button>
    </div>
  </header>

  <section class="card">
    <div class="categories" id="categories" role="tablist" aria-label="Categories"></div>
    <div class="quote-area">
      <div id="quote-box" class="quote-box" aria-live="polite">
        <p id="quote" class="quote-text">Loadingâ€¦</p>
        <p id="author" class="author"></p>
      </div>

        <div id="progress" style="font-size:0.9rem;color:var(--muted)">0 / 0</div>
      </div>
    </div>
  </section>

  <footer>
    &copy; Francis Otieno
  </footer>
</main>

<button id="btn-float-next" aria-label="Next Quote">Next</button>
<button id="btn-float-prev" aria-label="Previous Quote">Prev</button>

<script>
const DB = {}, state = { categories: [], active: null, pool: [], index: 0, random: false };
let autoMode = false, autoInterval = null;

const qs = s => document.querySelector(s), qsa = s => Array.from(document.querySelectorAll(s));
const LS = { get: (k, f) => { try { return JSON.parse(localStorage.getItem(k)) ?? f; } catch (e) { return f } }, set: (k, v) => localStorage.setItem(k, JSON.stringify(v)) };

// Fetch quotes.json with fallback
(async function loadQuotes(){
  try{
    const r = await fetch('quotes.json');
    if(!r.ok) throw new Error('fetch failed');
    const data = await r.json(); Object.assign(DB, data);
  }catch(e){
    console.warn('quotes load failed', e);
    DB['General'] = [{text:'Welcome â€” add quotes.json to get started',author:'App'}];
  } finally {
    state.categories = Object.keys(DB);
    initApp();
  }
})();

const quoteEl = qs('#quote'), authorEl = qs('#author'), progressEl = qs('#progress');
const categoriesEl = qs('#categories'), favPanel = qs('#favorites-panel'), favList = qs('#fav-list');

function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }

function buildCategories(){
  categoriesEl.innerHTML = '';
  state.categories.forEach((cat,i)=>{
    const btn = document.createElement('button');
    btn.className = 'cat'; btn.textContent = cat; btn.setAttribute('role','tab');
    btn.setAttribute('aria-selected','false'); btn.setAttribute('tabindex','0');
    btn.addEventListener('click', ()=> selectCategory(cat));
    btn.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); selectCategory(cat); } });
    categoriesEl.appendChild(btn);
  });
}

function selectCategory(cat){
  state.active = cat; state.pool = [...(DB[cat]||[])];
  if(!state.pool.length){ state.index = 0; updateCategoryUI(); displayEmpty(); return; }
  if(state.random) shuffle(state.pool);
  state.index = 0; updateCategoryUI(); showNext(true); LS.set('lastCategory',cat);
}

function updateCategoryUI(){
  qsa('.cat').forEach(el=>{
    el.classList.toggle('active', el.textContent===state.active);
    el.setAttribute('aria-selected', el.textContent===state.active? 'true':'false');
    if(el.textContent===state.active) el.focus();
  });
  const total = state.pool?.length||0; const current = Math.min(Math.max(state.index, (state.index>0?state.index:0)), total);
  progressEl.textContent = `${current} / ${total}`;
  updateFavButtonState();
}

function displayEmpty(){ quoteEl.textContent='No items in this category.'; authorEl.textContent=''; progressEl.textContent='0 / 0'; }

function showNext(skipFade=false){
  if(!state.pool || state.pool.length===0) return displayEmpty();
  if(state.index >= state.pool.length) state.index = 0;
  const item = state.pool[state.index++];
  displayQuote(item, skipFade);
}

function showPrevious(skipFade=false){
  if(!state.pool || state.pool.length===0) return displayEmpty();
  state.index--; if(state.index < 0) state.index = state.pool.length - 1;
  const item = state.pool[state.index];
  displayQuote(item, skipFade);
}

function displayQuote(item, skipFade){
  if(!skipFade){
    quoteEl.classList.add('enter'); authorEl.classList.add('enter');
    setTimeout(()=>{
      quoteEl.textContent = item.text;
      authorEl.textContent = item.author? `â€” ${item.author}` : '';
      void quoteEl.offsetWidth;
      quoteEl.classList.remove('enter'); authorEl.classList.remove('enter');
      updateCategoryUI();
    }, 120);
  } else {
    quoteEl.textContent = item.text; authorEl.textContent = item.author? `â€” ${item.author}` : '';
    updateCategoryUI();
  }
}

function wrapText(ctx, text, x, y, maxWidth, lineHeight){
  const words = text.split(' '); let line = '', lines = [];
  for(let n=0;n<words.length;n++){
    const testLine = line + words[n] + ' ';
    if(ctx.measureText(testLine).width > maxWidth && n>0){ lines.push(line); line = words[n] + ' '; } else { line = testLine; }
  }
  lines.push(line);
  lines.forEach((l,i)=> ctx.fillText(l, x, y + (i * lineHeight)));
}

function shareQuoteImage(){
  const text = quoteEl.textContent, author = authorEl.textContent.replace(/^â€”\s?/, '');
  const canvas = document.createElement('canvas'); canvas.width = 1200; canvas.height = 675;
  const ctx = canvas.getContext('2d');
  const grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height); grad.addColorStop(0,'#ffecd2'); grad.addColorStop(1,'#fcb69f'); ctx.fillStyle = grad; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#222'; ctx.textAlign = 'center'; ctx.font = 'bold 40px Inter, sans-serif';
  wrapText(ctx, text, canvas.width/2, 200, 1000, 56);
  if(author){ ctx.font = 'italic 30px Inter, sans-serif'; ctx.fillText(`â€” ${author}`, canvas.width/2, 520); }
  canvas.toBlob(async blob=>{
    const file = new File([blob], 'quote.png', { type: 'image/png' });
    if(navigator.canShare && navigator.canShare({ files: [file] })){ navigator.share({ files: [file], title: 'Daily Inspiration' }).catch(()=>{}); }
    else {
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'quote.png'; a.click(); URL.revokeObjectURL(url);
    }
  });
}

function enableNotifications(){
  if(!('Notification' in window)){ alert('Not supported'); return; }
  Notification.requestPermission().then(p=>{
    if(p==='granted'){ LS.set('notifications', true); scheduleDailyNotification(); qs('#btn-notify').textContent = 'ðŸ”” On'; qs('#btn-notify').setAttribute('aria-pressed','true'); }
    else alert('Notifications denied');
  });
}

function scheduleDailyNotification(){
  if(window._notifyInterval) clearInterval(window._notifyInterval);
  const msToNext = (hour=9)=>{ const now = new Date(); let t = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour); if(now > t) t.setDate(t.getDate()+1); return t - now; };
  setTimeout(()=>{ sendDailyNotification(); window._notifyInterval = setInterval(sendDailyNotification, 24*60*60*1000); }, msToNext());
}

function sendDailyNotification(){
  const cat = LS.get('lastCategory', state.categories[0]); const items = DB[cat] || []; if(!items.length) return;
  const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(),0,0))/1000/60/60/24);
  const item = items[dayOfYear % items.length];
  if('serviceWorker' in navigator && navigator.serviceWorker.controller){ navigator.serviceWorker.controller.postMessage({ type:'show-notification', title:'Daily Inspiration', body: item.text + (item.author?` â€” ${item.author}`:'') }); }
  else if(Notification.permission === 'granted'){ new Notification('Daily Inspiration', { body: item.text + (item.author?` â€” ${item.author}`:'') }); }
}

// --- Swipe gestures for mobile ---
let touchStartX = 0; let touchEndX = 0; const swipeThreshold = 50;
const touchTarget = qs('#quote-box');
touchTarget.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, { passive:true });
touchTarget.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; handleSwipe(); }, { passive:true });
function handleSwipe(){ const dx = touchEndX - touchStartX; if(Math.abs(dx) > swipeThreshold){ if(dx < 0) showNext(); else showPrevious(); } }

function initApp(){
  // wire up controls
  qs('#btn-float-next').onclick = showNext; qs('#btn-float-prev').onclick = showPrevious;
  qs('#btn-share-image').onclick = shareQuoteImage;
  qs('#btn-notify').onclick = enableNotifications;

  qs('#btn-random').onclick = ()=>{ state.random = !state.random; qs('#btn-random').classList.toggle('fav-active', state.random); LS.set('random', state.random); };}
  };

  buildCategories();
  const last = LS.get('lastCategory', state.categories[0] || 'General');
  if(state.categories.includes(last)) selectCategory(last); else selectCategory(state.categories[0]);
  renderFavorites();

  document.addEventListener('keydown', e=>{
    if(e.key===' '){ e.preventDefault(); showNext(); }
    if(e.key==='s') shareCurrent();
    if(e.key==='ArrowRight') showNext();
    if(e.key==='ArrowLeft') showPrevious();
  });

  if(LS.get('notifications', false) && Notification.permission === 'granted'){ qs('#btn-notify').textContent='ðŸ”” On'; qs('#btn-notify').setAttribute('aria-pressed','true'); scheduleDailyNotification(); }

  // register service worker relative to this file
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./service-worker.js').catch(e=>console.warn('SW failed', e)); }

  // handle install prompt
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', e=>{
    e.preventDefault(); deferredPrompt = e;
    const btn = document.createElement('button'); btn.textContent = 'Install App'; btn.className = 'small btn-ghost';
    btn.onclick = async ()=>{ btn.remove(); deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt = null; };
    document.querySelector('header').appendChild(btn);
  });

  // splash hide with transitionend
  const splash = qs('#splash');
  requestAnimationFrame(()=> splash.classList.add('hidden-splash'));
  splash.addEventListener('transitionend', ()=> { try{ splash.remove(); }catch(e){} });

  // load persisted UI state
  const persistedRandom = LS.get('random', false); if(persistedRandom){ state.random = true; qs('#btn-random').classList.add('fav-active'); }
}

</script>

</body>
</html>









